# Story 6.5: Real-time Recommendation Updates (SignalR)

## Status
Approved

## Story

**As a** dispatcher,
**I want** real-time updates when recommendations are ready,
**so that** I see new recommendations immediately without manual refresh.

## Acceptance Criteria

1. **SignalR Event:** RecommendationReady event published via SignalR
2. **Event Publishing:** Event published after recommendations generated
3. **Group Targeting:** Event sent to appropriate dispatcher groups
4. **Event Payload:** Event includes jobId and recommendation summary
5. **Frontend Integration:** Frontend subscribes to RecommendationReady events
6. **UI Updates:** Recommendations sheet updates on event
7. **Connection Handling:** Graceful handling of connection failures
8. **Event Ordering:** Events processed in order
9. **Performance:** Event publishing doesn't impact API performance
10. **Testing:** Comprehensive tests

## Tasks / Subtasks

- [ ] Implement RecommendationReady event
  - [ ] Create event structure
  - [ ] Include jobId and summary
  - [ ] Define event schema
- [ ] Publish event after recommendations
  - [ ] Publish after recommendations generated
  - [ ] Send to dispatcher groups
  - [ ] Include event payload
- [ ] Configure SignalR groups
  - [ ] Ensure dispatchers in correct groups
  - [ ] Handle group membership
- [ ] Update frontend SignalR client
  - [ ] Subscribe to RecommendationReady event
  - [ ] Handle event reception
  - [ ] Update recommendations UI
- [ ] Add connection handling
  - [ ] Handle connection failures
  - [ ] Implement reconnection logic
  - [ ] Handle event ordering
- [ ] Add error handling
  - [ ] Handle event publishing errors
  - [ ] Log errors
  - [ ] Graceful degradation
- [ ] Optimize performance
  - [ ] Async event publishing
  - [ ] Don't block API response
- [ ] Create unit tests
  - [ ] Test event publishing
  - [ ] Test group targeting
  - [ ] Test frontend integration

## Dev Notes

### Relevant Source Tree Info
- SignalR hub: `src/SmartScheduler.Realtime/Hubs/RecommendationsHub.cs`
- Event publishing: `src/SmartScheduler.Application/Recommendations/Services/RecommendationService.cs`
- Frontend client: `frontend/lib/realtime/signalr-client.ts`

### Architecture References
- **SignalR Events:** See `docs/prd/realtime.md` for RecommendationReady event
- **SignalR Setup:** See Story 0.3 for SignalR setup
- **Real-time:** SignalR for real-time updates - see architecture

### Testing Standards
- **Test Location:** `src/SmartScheduler.Realtime.Tests/` and `frontend/__tests__/`
- **Event Tests:** Test event publishing, group targeting
- **Integration Tests:** Test end-to-end real-time flow

### UI Integration Notes
- Frontend needs SignalR client connection
- RecommendationsSheet updates on RecommendationReady event
- UI components already exist - needs SignalR integration

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

