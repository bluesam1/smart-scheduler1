# Story 2.4: Address Validation Integration (Google Places)

## Status
Approved

## Story

**As a** dispatcher,
**I want** addresses validated using Google Places API,
**so that** job locations are accurate and structured for distance calculations.

## Acceptance Criteria

1. **Google Places Client:** Google Places Autocomplete client integrated
2. **Place Details:** Place Details API called to get structured address
3. **Structured Address:** Address parsed into components (street, city, state, postal code)
4. **Coordinates:** Latitude/longitude extracted from place
5. **Place ID Caching:** Place Details cached by place_id
6. **Error Handling:** Graceful fallback if Google Places unavailable
7. **Cost Optimization:** Autocomplete sessions no-charge, only Place Details charged
8. **API Key Management:** Google Places API key stored in AWS Secrets Manager
9. **Frontend Integration:** Frontend AddressInput uses Google Places Autocomplete
10. **Backend Validation:** Backend validates and stores structured address

## Tasks / Subtasks

- [ ] Configure Google Places API
  - [ ] Get Google Places API key
  - [ ] Store key in AWS Secrets Manager
  - [ ] Configure API key retrieval
- [ ] Create address validation service
  - [ ] Create `IAddressValidationService` interface
  - [ ] Implement Google Places client
  - [ ] Implement Place Details retrieval
  - [ ] Parse structured address components
- [ ] Implement caching
  - [ ] Cache Place Details by place_id
  - [ ] Use in-memory cache (IMemoryCache)
  - [ ] Set appropriate TTL
- [ ] Integrate with job creation
  - [ ] Call address validation in CreateJobCommand
  - [ ] Store structured address in job entity
  - [ ] Handle validation errors
- [ ] Add error handling
  - [ ] Handle API failures gracefully
  - [ ] Allow manual address entry as fallback
  - [ ] Log errors for monitoring
- [ ] Update frontend AddressInput
  - [ ] Configure Google Places Autocomplete widget
  - [ ] Get Place Details on selection
  - [ ] Send structured address to backend
- [ ] Document integration
  - [ ] Document API key setup
  - [ ] Document cost optimization strategies
  - [ ] Document error handling

## Dev Notes

### Relevant Source Tree Info
- Address service: `src/SmartScheduler.Infrastructure/Services/AddressValidationService.cs`
- Google Places client: `src/SmartScheduler.Infrastructure/ExternalServices/GooglePlacesClient.cs`
- Frontend component: `frontend/components/ui/address-input.tsx`

### Architecture References
- **Address Validation:** See `docs/architecture/api-specification.md` section "Address Validation Integration"
- **Google Places:** See `docs/prd/epic-2-job-intake-attributes-windows.md`
- **Caching:** In-memory cache for MVP - see architecture spec

### Testing Standards
- **Test Location:** `src/SmartScheduler.Infrastructure.Tests/`
- **Service Tests:** Mock Google Places API, test address parsing
- **Integration Tests:** Test with real API (optional, may be expensive)

### UI Integration Notes
- Frontend has `AddressInput` component (see `frontend/components/ui/address-input.tsx`)
- Frontend needs Google Places API key in environment variables
- Frontend should use Autocomplete widget (no-charge) and Place Details (charged)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

