# Story 8.1: Reschedule Domain Logic

## Status
Approved

## Story

**As a** system,
**I want** domain logic for rescheduling jobs,
**so that** jobs can be moved to different time slots with proper validation.

## Acceptance Criteria

1. **Reschedule Command:** RescheduleJobCommand with new time slot
2. **Feasibility Check:** New time slot validated for feasibility
3. **Conflict Detection:** Conflicts with existing assignments detected
4. **Assignment Update:** Existing assignment updated with new times
5. **Status Management:** Job status updated appropriately
6. **Domain Events:** JobRescheduled event published
7. **Validation:** Business rules enforced
8. **Error Handling:** Clear errors for invalid reschedules
9. **Testing:** Comprehensive domain tests
10. **Documentation:** Reschedule logic documented

## Tasks / Subtasks

- [ ] Create reschedule command
  - [ ] Create `RescheduleJobCommand`
  - [ ] Include job ID and new time slot
  - [ ] Create command handler
- [ ] Implement feasibility check
  - [ ] Validate new time slot
  - [ ] Check contractor availability
  - [ ] Verify no conflicts
- [ ] Implement conflict detection
  - [ ] Check for overlapping assignments
  - [ ] Check for travel buffer violations
  - [ ] Reject if conflicts found
- [ ] Update assignment
  - [ ] Update assignment time slots
  - [ ] Maintain assignment relationships
  - [ ] Update timestamps
- [ ] Publish domain event
  - [ ] Create JobRescheduled event
  - [ ] Include old and new times
  - [ ] Publish event
- [ ] Add validation
  - [ ] Validate new time slot
  - [ ] Validate job exists
  - [ ] Validate assignment exists
- [ ] Add unit tests
  - [ ] Test reschedule logic
  - [ ] Test conflict detection
  - [ ] Test validation

## Dev Notes

### Relevant Source Tree Info
- Command: `src/SmartScheduler.Application/Jobs/Commands/RescheduleJobCommand.cs`
- Domain event: `src/SmartScheduler.Domain/Jobs/Events/JobRescheduled.cs`

### Architecture References
- **Reschedule:** See `docs/prd/epic-8-reschedulecancel-calendar-integrity.md`
- **Domain Events:** See `docs/prd/domain-events-integrations.md` for JobRescheduled event
- **Feasibility:** Uses availability engine - see Epic 3

### Testing Standards
- **Test Location:** `src/SmartScheduler.Application.Tests/`
- **Reschedule Tests:** Test logic, conflicts, validation

### UI Integration Notes
- Reschedule functionality in job details UI
- UI shows available time slots for reschedule
- UI is 95% complete - needs API integration

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

