# Story 7.5: JobAssigned Event Publishing

## Status
Approved

## Story

**As a** system,
**I want** to publish JobAssigned events when assignments are created,
**so that** real-time updates are sent to dispatchers and contractors.

## Acceptance Criteria

1. **Event Creation:** JobAssigned domain event created
2. **Event Publishing:** Event published after assignment creation
3. **SignalR Publishing:** Event published via SignalR to appropriate groups
4. **Event Payload:** Event includes job and assignment details
5. **Group Targeting:** Event sent to dispatcher and contractor groups
6. **Event Logging:** Event logged to EventLog table
7. **In-Process Publishing:** Events published in-process (MVP)
8. **Error Handling:** Graceful handling of publishing failures
9. **Performance:** Event publishing doesn't block assignment
10. **Testing:** Comprehensive tests

## Tasks / Subtasks

- [ ] Create JobAssigned event
  - [ ] Create domain event
  - [ ] Include job and assignment details
  - [ ] Define event schema
- [ ] Implement event publishing
  - [ ] Publish event after assignment creation
  - [ ] Use in-process publisher (MVP)
  - [ ] Publish to SignalR
- [ ] Configure SignalR groups
  - [ ] Send to dispatcher groups
  - [ ] Send to contractor group
  - [ ] Include event payload
- [ ] Log to EventLog
  - [ ] Persist event to EventLog table
  - [ ] Include event type and payload
  - [ ] Track published groups
- [ ] Add error handling
  - [ ] Handle publishing failures
  - [ ] Log errors
  - [ ] Don't fail assignment on publish error
- [ ] Optimize performance
  - [ ] Async event publishing
  - [ ] Don't block assignment response
- [ ] Create unit tests
  - [ ] Test event creation
  - [ ] Test event publishing
  - [ ] Test SignalR integration

## Dev Notes

### Relevant Source Tree Info
- Domain event: `src/SmartScheduler.Domain/Jobs/Events/JobAssigned.cs`
- Event publisher: `src/SmartScheduler.Application/Events/EventPublisher.cs`
- SignalR hub: `src/SmartScheduler.Realtime/Hubs/JobsHub.cs`

### Architecture References
- **Domain Events:** See `docs/prd/domain-events-integrations.md` for JobAssigned event
- **In-Process Publishing:** MVP uses in-process - see `docs/architecture/high-level-architecture.md`
- **EventLog:** Events logged to EventLog table - see architecture

### Testing Standards
- **Test Location:** `src/SmartScheduler.Application.Tests/` and `src/SmartScheduler.Realtime.Tests/`
- **Event Tests:** Test event creation, publishing, SignalR integration

### UI Integration Notes
- Frontend listens for JobAssigned events
- UI updates when event received
- Real-time updates improve user experience

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

