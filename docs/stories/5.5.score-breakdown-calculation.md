# Story 5.5: Score Breakdown Calculation

## Status
Approved

## Story

**As a** dispatcher,
**I want** to see a breakdown of how each recommendation score was calculated,
**so that** I can understand why contractors were ranked as they were.

## Acceptance Criteria

1. **Breakdown Structure:** ScoreBreakdown includes availability, rating, distance, optional rotation
2. **Per-Factor Scores:** Each factor score calculated and included
3. **Score Range:** All factor scores in 0-100 range
4. **Breakdown DTO:** ScoreBreakdown DTO matches API specification
5. **Included in Response:** Breakdown included in recommendation response
6. **Consistency:** Breakdown matches final score calculation
7. **Optional Fields:** Rotation score optional (only if rotation applied)
8. **Performance:** Breakdown calculation doesn't impact performance
9. **Testing:** Comprehensive tests
10. **Documentation:** Breakdown structure documented

## Tasks / Subtasks

- [ ] Create ScoreBreakdown DTO
  - [ ] Create `ScoreBreakdown` class
  - [ ] Include all factor scores
  - [ ] Make rotation optional
- [ ] Calculate availability score
  - [ ] Calculate in scoring service
  - [ ] Normalize to 0-100
  - [ ] Include in breakdown
- [ ] Calculate rating score
  - [ ] Use contractor rating (0-100)
  - [ ] Include in breakdown
- [ ] Calculate distance score
  - [ ] Normalize distance to 0-100
  - [ ] Include in breakdown
- [ ] Calculate rotation score (optional)
  - [ ] Calculate if rotation applied
  - [ ] Include in breakdown if present
- [ ] Include in recommendation
  - [ ] Add breakdown to Recommendation DTO
  - [ ] Include in API response
- [ ] Add unit tests
  - [ ] Test breakdown calculation
  - [ ] Test score consistency
  - [ ] Test optional rotation
- [ ] Verify API spec compliance
  - [ ] Ensure breakdown matches API spec
  - [ ] Verify all required fields

## Dev Notes

### Relevant Source Tree Info
- Score breakdown: `src/SmartScheduler.Application/DTOs/ScoreBreakdown.cs`
- Calculation: In scoring service

### Architecture References
- **Score Breakdown:** See `docs/architecture/data-models.md` for ScoreBreakdown model
- **API Specification:** See `docs/architecture/api-specification.md` for breakdown structure

### Testing Standards
- **Test Location:** `src/SmartScheduler.Application.Tests/`
- **Breakdown Tests:** Test calculation, consistency, optional fields

### UI Integration Notes
- Breakdown displayed in recommendation cards
- Frontend shows score breakdown in UI
- UI components already exist
- UI is 95% complete - needs API integration

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

