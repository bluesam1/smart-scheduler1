# Story 1.6: Contractor Rating System

## Status
Approved

## Story

**As a** system,
**I want** contractor ratings to be managed and updated,
**so that** the scoring algorithm can use ratings for recommendations.

## Acceptance Criteria

1. **Rating Storage:** Contractor rating stored (0-100, defaults to 50)
2. **Rating Updates:** Rating can be updated via API
3. **Rating Validation:** Rating must be between 0-100
4. **Rating Events:** ContractorRated domain event published on rating change
5. **Rating History:** Optional rating history tracking (future enhancement)
6. **Default Rating:** New contractors get default rating of 50
7. **Rating Calculation:** Composite rating calculation logic (if applicable)
8. **Authorization:** Only Admin can update ratings (or system automatically)
9. **API Endpoint:** PUT /contractors/{id}/rating endpoint
10. **Event Publishing:** Rating changes trigger ContractorRated event

## Tasks / Subtasks

- [ ] Implement rating in domain
  - [ ] Ensure rating property in Contractor entity
  - [ ] Add rating validation (0-100)
  - [ ] Set default rating to 50
- [ ] Create rating update command
  - [ ] Create `UpdateContractorRatingCommand`
  - [ ] Create command handler
  - [ ] Validate rating range
- [ ] Create API endpoint
  - [ ] `PUT /contractors/{id}/rating` endpoint
  - [ ] Accept rating value in request body
  - [ ] Return updated contractor
- [ ] Implement domain event
  - [ ] Create `ContractorRated` domain event
  - [ ] Publish event on rating update
  - [ ] Include old and new rating in event
- [ ] Add authorization
  - [ ] Admin-only access for rating updates
  - [ ] Or system-automated rating updates
- [ ] Update contractor creation
  - [ ] Ensure default rating of 50 on creation
  - [ ] Verify rating is set correctly

## Dev Notes

### Relevant Source Tree Info
- Domain event: `src/SmartScheduler.Domain/Contracts/Events/ContractorRated.cs`
- Command: `src/SmartScheduler.Application/Contracts/Commands/UpdateContractorRatingCommand.cs`
- API endpoint: `src/SmartScheduler.Api/Endpoints/Contractors/`

### Architecture References
- **Data Models:** See `docs/architecture/data-models.md` for Contractor rating field
- **Domain Events:** See `docs/prd/domain-events-integrations.md` for ContractorRated event
- **Scoring:** Rating used in scoring algorithm - see Epic 5

### Testing Standards
- **Test Location:** `src/SmartScheduler.Api.Tests/` and `src/SmartScheduler.Application.Tests/`
- **Rating Tests:** Test rating validation, default values, updates
- **Event Tests:** Test ContractorRated event publishing

### UI Integration Notes
- Frontend displays contractor ratings in contractor cards
- Rating updates may be manual (admin) or automatic (system)
- UI already shows ratings - needs API integration

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

