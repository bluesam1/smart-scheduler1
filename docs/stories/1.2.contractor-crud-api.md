# Story 1.2: Contractor CRUD API

## Status
Approved

## Story

**As a** dispatcher or admin,
**I want** to create, read, update, and delete contractors via REST API,
**so that** I can manage contractor profiles in the system.

## Acceptance Criteria

1. **GET /contractors:** List all contractors with optional skill filtering
2. **GET /contractors/{id}:** Get contractor by ID
3. **POST /contractors:** Create new contractor with validation
4. **PUT /contractors/{id}:** Update existing contractor
5. **Authorization:** Admin and Dispatcher roles can perform CRUD operations
6. **Validation:** All input validated according to domain rules
7. **Error Handling:** Proper HTTP status codes (400, 404, 409)
8. **DTOs:** Request/Response DTOs match API specification
9. **OpenAPI:** Endpoints documented in OpenAPI/Swagger
10. **Database Persistence:** Changes persisted to PostgreSQL

## Tasks / Subtasks

- [ ] Create DTOs
  - [ ] Create `ContractorDto` response DTO
  - [ ] Create `CreateContractorRequest` DTO
  - [ ] Create `UpdateContractorRequest` DTO
  - [ ] Map domain entities to DTOs
- [ ] Implement MediatR commands/queries
  - [ ] Create `GetContractorsQuery` with skill filtering
  - [ ] Create `GetContractorByIdQuery`
  - [ ] Create `CreateContractorCommand`
  - [ ] Create `UpdateContractorCommand`
  - [ ] Create handlers for each command/query
- [ ] Implement repository
  - [ ] Implement `ContractorRepository` in Infrastructure layer
  - [ ] Use EF Core for data access
  - [ ] Implement skill filtering query
- [ ] Create API endpoints
  - [ ] `GET /contractors` - list with optional `?skills=` and `?limit=` params
  - [ ] `GET /contractors/{id}` - get by ID
  - [ ] `POST /contractors` - create new
  - [ ] `PUT /contractors/{id}` - update existing
- [ ] Add authorization
  - [ ] Apply `[Authorize]` with Admin/Dispatcher policy
  - [ ] Verify role-based access
- [ ] Implement validation
  - [ ] FluentValidation for request DTOs
  - [ ] Domain validation in command handlers
- [ ] Configure EF Core entities
  - [ ] Create `Contractor` EF Core entity configuration
  - [ ] Configure relationships and value object mapping
  - [ ] Create database migration

## Dev Notes

### Relevant Source Tree Info
- API endpoints: `src/SmartScheduler.Api/Endpoints/Contractors/`
- Commands/Queries: `src/SmartScheduler.Application/Contracts/Commands/` and `Queries/`
- Handlers: `src/SmartScheduler.Application/Contracts/Handlers/`
- Repository: `src/SmartScheduler.Infrastructure/Repositories/`
- DTOs: `src/SmartScheduler.Application/DTOs/`

### Architecture References
- **API Specification:** See `docs/architecture/api-specification.md` for exact endpoint specifications
- **CQRS:** MediatR pattern - see `docs/architecture/high-level-architecture.md`
- **Data Models:** See `docs/architecture/data-models.md` for Contractor model

### Testing Standards
- **Test Location:** `src/SmartScheduler.Api.Tests/` and `src/SmartScheduler.Application.Tests/`
- **API Tests:** Integration tests for endpoints, unit tests for handlers
- **Test Scenarios:** Create, read, update, delete, validation errors, authorization failures

### UI Integration Notes
- Frontend has `ContractorList` component with mock data (see `frontend/components/contractors/contractor-list.tsx`)
- Frontend has `AddContractorDialog` component (see `frontend/components/contractors/add-contractor-dialog.tsx`)
- Frontend expects API at `/contractors` endpoint
- Frontend will use generated TypeScript client from NSwag (created in Story 0.1)
- UI is 95% complete - only needs API integration

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

