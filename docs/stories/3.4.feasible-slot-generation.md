# Story 3.4: Feasible Slot Generation

## Status
Approved

## Story

**As a** system,
**I want** to generate feasible time slots for contractors,
**so that** recommendations can suggest specific times for job assignments.

## Acceptance Criteria

1. **Slot Generation:** Generate feasible slots within service window
2. **Multiple Slots:** Generate up to 3 slots per contractor (earliest, lowest-travel, highest-confidence)
3. **Slot Types:** Different slot types for different optimization goals
4. **Confidence Scoring:** Calculate confidence score for each slot
5. **Feasibility Checks:** Verify slots are feasible (working hours, existing jobs, buffers)
6. **Slot Format:** Slots include startUtc, endUtc, type, confidence
7. **Performance:** Efficient slot generation
8. **Edge Cases:** Handle cases with no feasible slots
9. **Deterministic:** Same inputs produce same slots
10. **Integration:** Slots integrated with recommendations API

## Tasks / Subtasks

- [ ] Create slot generation service
  - [ ] Create `ISlotGenerator` interface
  - [ ] Implement slot generation logic
- [ ] Implement earliest slot generation
  - [ ] Find earliest feasible start time
  - [ ] Calculate slot end time (duration + buffer)
  - [ ] Verify feasibility
- [ ] Implement lowest-travel slot generation
  - [ ] Consider travel time from previous job
  - [ ] Find slot with minimum travel
  - [ ] Calculate slot timing
- [ ] Implement highest-confidence slot generation
  - [ ] Calculate confidence based on factors
  - [ ] Find slot with highest confidence
  - [ ] Consider availability, travel, contractor rating
- [ ] Implement confidence calculation
  - [ ] Factor in availability window size
  - [ ] Factor in travel time
  - [ ] Factor in contractor reliability
  - [ ] Return 0-100 confidence score
- [ ] Integrate with availability engine
  - [ ] Use availability engine for feasibility
  - [ ] Apply travel buffers
  - [ ] Consider existing assignments
- [ ] Create slot DTOs
  - [ ] Create `TimeSlot` DTO
  - [ ] Include all required fields
- [ ] Add unit tests
  - [ ] Test slot generation scenarios
  - [ ] Test confidence calculation
  - [ ] Test edge cases

## Dev Notes

### Relevant Source Tree Info
- Slot generator: `src/SmartScheduler.Domain/Scheduling/Services/SlotGenerator.cs`
- Slot DTOs: `src/SmartScheduler.Application/DTOs/TimeSlot.cs`

### Architecture References
- **Time Slots:** See `docs/architecture/data-models.md` for TimeSlot model
- **Recommendations:** Up to 3 slots per contractor - see `docs/architecture/api-specification.md`
- **Slot Types:** earliest, lowest-travel, highest-confidence - see PRD

### Testing Standards
- **Test Location:** `src/SmartScheduler.Domain.Tests/`
- **Slot Generation Tests:** Test various scenarios
- **Confidence Tests:** Test confidence calculation
- **Integration Tests:** Test with availability engine

### UI Integration Notes
- Slots displayed in recommendation cards
- Frontend has `RecommendationCard` component showing slots
- UI is 95% complete - needs API integration

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

