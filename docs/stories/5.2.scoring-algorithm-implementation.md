# Story 5.2: Scoring Algorithm Implementation

## Status
Approved

## Story

**As a** system,
**I want** a scoring algorithm to rank contractors,
**so that** recommendations show the best matches first.

## Acceptance Criteria

1. **Scoring Service:** Scoring service implemented
2. **Factor Scores:** Calculate scores for availability, rating, distance
3. **Weighted Combination:** Combine factor scores using configurable weights
4. **Score Range:** Final scores in 0-100 range
5. **Deterministic:** Same inputs produce same scores
6. **Performance:** Efficient scoring calculation
7. **Score Breakdown:** Per-factor scores included in results
8. **Normalization:** Factor scores normalized appropriately
9. **Integration:** Integrated with recommendations flow
10. **Testing:** Comprehensive unit tests

## Tasks / Subtasks

- [ ] Create scoring service
  - [ ] Create `IScoringService` interface
  - [ ] Implement scoring algorithm
- [ ] Implement availability scoring
  - [ ] Calculate availability score (0-100)
  - [ ] Factor in available time windows
  - [ ] Normalize score
- [ ] Implement rating scoring
  - [ ] Use contractor rating directly (0-100)
  - [ ] No normalization needed
- [ ] Implement distance scoring
  - [ ] Normalize distance to 0-100 score
  - [ ] Shorter distance = higher score
  - [ ] Handle edge cases (zero distance, very long distance)
- [ ] Implement weighted combination
  - [ ] Load weights from configuration
  - [ ] Calculate weighted sum
  - [ ] Ensure result in 0-100 range
- [ ] Generate score breakdown
  - [ ] Include per-factor scores
  - [ ] Include final weighted score
  - [ ] Include in recommendation DTO
- [ ] Add unit tests
  - [ ] Test scoring algorithm
  - [ ] Test normalization
  - [ ] Test edge cases
  - [ ] Test deterministic behavior
- [ ] Integrate with recommendations
  - [ ] Use scoring in recommendations flow
  - [ ] Score all candidates
  - [ ] Include scores in response

## Dev Notes

### Relevant Source Tree Info
- Scoring service: `src/SmartScheduler.Application/Recommendations/Services/ScoringService.cs`
- Score breakdown: `src/SmartScheduler.Application/DTOs/ScoreBreakdown.cs`

### Architecture References
- **Scoring Algorithm:** See `docs/prd/epic-5-scoring-ranking-v1-rules.md`
- **Score Breakdown:** See `docs/architecture/data-models.md` for ScoreBreakdown
- **Weights:** Configurable weights - see Epic 5.1

### Testing Standards
- **Test Location:** `src/SmartScheduler.Application.Tests/`
- **Scoring Tests:** Test algorithm, normalization, edge cases
- **Deterministic Tests:** Verify same inputs produce same outputs

### UI Integration Notes
- Scores displayed in recommendation cards
- Score breakdown shown in UI
- Frontend has recommendation display components
- UI is 95% complete - needs API integration

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

