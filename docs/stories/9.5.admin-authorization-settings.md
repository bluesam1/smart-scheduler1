# Story 9.5: Admin Authorization for Settings

## Status
Approved

## Story

**As a** system,
**I want** settings endpoints to be admin-only,
**so that** only authorized users can modify system configuration.

## Acceptance Criteria

1. **Admin Policy:** Admin-only authorization policy created
2. **Settings Protection:** All settings endpoints protected
3. **Weights Protection:** Weights management endpoints protected
4. **Role Verification:** Admin role verified from JWT
5. **Error Responses:** Proper 403 responses for non-admins
6. **Frontend Protection:** Frontend checks admin role
7. **UI Hiding:** Settings UI hidden for non-admins
8. **Testing:** Comprehensive authorization tests
9. **Documentation:** Authorization requirements documented
10. **Security:** Authorization properly enforced

## Tasks / Subtasks

- [ ] Create Admin policy
  - [ ] Create Admin authorization policy
  - [ ] Verify Admin role from JWT groups claim
  - [ ] Configure policy in startup
- [ ] Protect settings endpoints
  - [ ] Apply [Authorize(Policy = "Admin")] to all settings endpoints
  - [ ] Verify protection works
- [ ] Protect weights endpoints
  - [ ] Apply Admin policy to weights endpoints
  - [ ] Verify protection
- [ ] Add frontend role check
  - [ ] Check admin role in frontend
  - [ ] Hide settings UI for non-admins
  - [ ] Show access denied message
- [ ] Add error handling
  - [ ] Return 403 for unauthorized
  - [ ] Clear error messages
- [ ] Create unit tests
  - [ ] Test authorization policies
  - [ ] Test endpoint protection
  - [ ] Test frontend role checks
- [ ] Document authorization
  - [ ] Document admin requirements
  - [ ] Document role setup

## Dev Notes

### Relevant Source Tree Info
- Authorization policies: `src/SmartScheduler.Api/Policies/AdminPolicy.cs`
- Settings endpoints: `src/SmartScheduler.Api/Endpoints/Settings/`
- Frontend role check: `frontend/lib/auth/role-check.ts`

### Architecture References
- **Authorization:** Policy-based authorization - see `docs/architecture/api-specification.md`
- **Roles:** Admin, Dispatcher, Contractor - see architecture
- **JWT:** Roles from groups claim - see Story 0.2

### Testing Standards
- **Test Location:** `src/SmartScheduler.Api.Tests/`
- **Auth Tests:** Test authorization policies, endpoint protection
- **Frontend Tests:** Test role checks, UI hiding

### UI Integration Notes
- Settings page checks admin role
- UI hidden for non-admins
- Access denied message shown

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

