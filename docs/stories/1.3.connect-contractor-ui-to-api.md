# Story 1.3: Connect Contractor UI to API

## Status
Approved

## Story

**As a** dispatcher,
**I want** the contractor list and forms to use real API data instead of mock data,
**so that** I can manage real contractors in the system.

## Acceptance Criteria

1. **API Client Integration:** Frontend uses generated TypeScript API client
2. **Replace Mock Data:** All mock contractor data replaced with API calls
3. **Contractor List:** Contractor list loads from GET /contractors
4. **Create Contractor:** Add contractor dialog submits to POST /contractors
5. **Update Contractor:** Contractor edit functionality uses PUT /contractors/{id}
6. **Error Handling:** Proper error messages displayed for API failures
7. **Loading States:** Loading indicators shown during API calls
8. **Authentication:** API calls include JWT token from Cognito
9. **Real-time Updates:** Contractor list updates when new contractors added (via SignalR)
10. **Type Safety:** TypeScript types match backend DTOs

## Tasks / Subtasks

- [ ] Generate TypeScript API client
  - [ ] Configure NSwag to generate client from OpenAPI spec
  - [ ] Generate client to `frontend/lib/api/generated/api-client.ts`
  - [ ] Verify interface-based models (not classes)
- [ ] Create API client factory
  - [ ] Create `frontend/lib/api/api-client-config.ts`
  - [ ] Implement factory function with auth token
  - [ ] Configure base URL from environment
- [ ] Update ContractorList component
  - [ ] Replace mock data with API call to GET /contractors
  - [ ] Add loading state
  - [ ] Add error handling
  - [ ] Implement skill filtering if needed
- [ ] Update AddContractorDialog
  - [ ] Replace mock submission with POST /contractors
  - [ ] Handle validation errors from API
  - [ ] Show success message
  - [ ] Refresh contractor list after creation
- [ ] Update contractor edit functionality
  - [ ] Connect to PUT /contractors/{id}
  - [ ] Handle update errors
- [ ] Add authentication integration
  - [ ] Get JWT token from Cognito
  - [ ] Include token in API request headers
  - [ ] Handle token expiration/refresh
- [ ] Add SignalR integration (if available)
  - [ ] Subscribe to contractor-related events
  - [ ] Update list when events received

## Dev Notes

### Relevant Source Tree Info
- Frontend components: `frontend/components/contractors/`
- API client: `frontend/lib/api/generated/api-client.ts`
- API config: `frontend/lib/api/api-client-config.ts`

### Architecture References
- **API Client Generation:** See `docs/architecture/api-client-generation.md` for NSwag configuration
- **API Specification:** See `docs/architecture/api-specification.md` for endpoint details
- **UI Components:** Frontend components already exist - see `frontend/components/contractors/`

### Testing Standards
- **Test Location:** `frontend/__tests__/` (if using Jest)
- **Component Tests:** Test API integration, loading states, error handling
- **E2E Tests:** Playwright tests for contractor CRUD flow

### UI Integration Notes
- **Existing UI:** Contractor UI is 95% complete with mock data
- **Components to Update:**
  - `frontend/components/contractors/contractor-list.tsx` - replace mock data
  - `frontend/components/contractors/add-contractor-dialog.tsx` - connect to API
  - `frontend/components/contractors/contractor-details-dialog.tsx` - connect to API
- **Mock Data Location:** Currently in component files (e.g., `mockContractors` array)
- **Authentication:** Frontend needs Cognito integration (may be separate story)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

