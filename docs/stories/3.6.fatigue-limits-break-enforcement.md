# Story 3.6: Fatigue Limits & Break Enforcement

## Status
Approved

## Story

**As a** system,
**I want** to enforce fatigue limits and break requirements,
**so that** contractors don't exceed safe working hours and get adequate rest.

## Acceptance Criteria

1. **Daily Hours Limit:** Enforce 8h target, 10h soft cap, 12h hard stop
2. **Consecutive Jobs Limit:** Max 4 consecutive jobs without 15m break
3. **Break Enforcement:** Enforce break requirements between jobs
4. **Rush Job Handling:** Rush jobs may bypass soft caps but never hard stops
5. **Fatigue Calculation:** Calculate current daily hours and consecutive jobs
6. **Feasibility Checks:** Include fatigue limits in feasibility checks
7. **Break Time:** Account for break time in slot generation
8. **Configuration:** Fatigue limits configurable
9. **Edge Cases:** Handle edge cases (midnight boundaries, long jobs)
10. **Documentation:** Fatigue policy documented

## Tasks / Subtasks

- [ ] Create fatigue calculation service
  - [ ] Create `IFatigueCalculator` interface
  - [ ] Calculate daily hours worked
  - [ ] Calculate consecutive jobs count
- [ ] Implement daily hours limits
  - [ ] Track hours worked per day
  - [ ] Enforce 8h target (warning)
  - [ ] Enforce 10h soft cap (block unless rush)
  - [ ] Enforce 12h hard stop (always block)
- [ ] Implement consecutive jobs limit
  - [ ] Track consecutive jobs without break
  - [ ] Enforce 15m break after 4 consecutive jobs
  - [ ] Calculate break requirement
- [ ] Implement break enforcement
  - [ ] Require breaks between jobs when needed
  - [ ] Account for break time in slot generation
  - [ ] Apply break time in availability calculation
- [ ] Handle rush jobs
  - [ ] Allow rush jobs to bypass soft cap
  - [ ] Never allow rush jobs to bypass hard stop
  - [ ] Flag rush job assignments
- [ ] Integrate with availability engine
  - [ ] Include fatigue checks in feasibility
  - [ ] Block slots that violate limits
  - [ ] Include break time in calculations
- [ ] Add configuration
  - [ ] Make limits configurable
  - [ ] Support regional variations
- [ ] Create unit tests
  - [ ] Test daily hours limits
  - [ ] Test consecutive jobs limit
  - [ ] Test break enforcement
  - [ ] Test rush job handling

## Dev Notes

### Relevant Source Tree Info
- Fatigue calculator: `src/SmartScheduler.Domain/Scheduling/Services/FatigueCalculator.cs`
- Fatigue configuration: `src/SmartScheduler.Application/Scheduling/Configuration/FatigueLimitsConfig.cs`

### Architecture References
- **Fatigue Limits:** See `docs/prd.md` section "Work Hours & Fatigue Limits"
- **Limits:** 8h target, 10h soft cap, 12h hard stop - see PRD
- **Breaks:** 15m break after 4 consecutive jobs - see PRD

### Testing Standards
- **Test Location:** `src/SmartScheduler.Domain.Tests/`
- **Fatigue Tests:** Test daily hours limits, consecutive jobs, breaks
- **Edge Case Tests:** Test midnight boundaries, long jobs

### UI Integration Notes
- Fatigue limits not directly displayed
- Limits affect available slots shown
- Warnings may be shown for approaching limits (future)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

