# Story 3.3: Travel Buffer Policy Implementation

## Status
Approved

## Story

**As a** system,
**I want** travel buffers applied between job assignments,
**so that** contractors have adequate time to travel between locations.

## Acceptance Criteria

1. **Buffer Calculation:** Buffer calculated as max(10m, min(45m, ETA × 0.25))
2. **Base-to-First:** Buffer applied from contractor base to first job
3. **Job-to-Job:** Buffer applied between sequential jobs
4. **Last-to-Base:** Optional buffer from last job back to base
5. **Regional Configuration:** Buffer multipliers configurable by region
6. **Buffer Application:** Buffers included in feasibility checks
7. **Time Block Carving:** Buffers part of time-block calculation
8. **Edge Cases:** Handle edge cases (same location, very short distances)
9. **Configuration:** Buffer policy configurable
10. **Documentation:** Buffer policy documented

## Tasks / Subtasks

- [ ] Create buffer calculation service
  - [ ] Create `ITravelBufferService` interface
  - [ ] Implement buffer calculation formula
  - [ ] Handle regional multipliers
- [ ] Implement base-to-first buffer
  - [ ] Calculate buffer from base to first job
  - [ ] Apply buffer in slot generation
- [ ] Implement job-to-job buffer
  - [ ] Calculate buffer between sequential jobs
  - [ ] Apply buffer in availability calculation
- [ ] Implement last-to-base buffer (optional)
  - [ ] Calculate buffer from last job to base
  - [ ] Make configurable (may be optional)
- [ ] Integrate with availability engine
  - [ ] Apply buffers in slot generation
  - [ ] Include buffers in time calculations
- [ ] Add regional configuration
  - [ ] Support regional buffer multipliers
  - [ ] Load configuration from config store
- [ ] Handle edge cases
  - [ ] Same location (minimal buffer)
  - [ ] Very short distances (minimum 10m)
  - [ ] Very long distances (maximum 45m)
- [ ] Create unit tests
  - [ ] Test buffer calculation formula
  - [ ] Test edge cases
  - [ ] Test regional multipliers

## Dev Notes

### Relevant Source Tree Info
- Buffer service: `src/SmartScheduler.Domain/Scheduling/Services/TravelBufferService.cs`
- Buffer configuration: `src/SmartScheduler.Application/Scheduling/Configuration/TravelBufferConfig.cs`

### Architecture References
- **Travel Buffer Policy:** See `docs/prd.md` section "Travel Buffer Policy"
- **Formula:** max(10m, min(45m, ETA × 0.25)) - see PRD
- **Regional Settings:** See `docs/prd/c-weights-regional-settings-appconfigparameter-store.md`

### Testing Standards
- **Test Location:** `src/SmartScheduler.Domain.Tests/`
- **Buffer Tests:** Test calculation formula, edge cases
- **Integration Tests:** Test buffer application in availability engine

### UI Integration Notes
- Buffers not directly displayed in UI
- Buffers affect available time slots shown
- Travel time displayed in recommendations

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

