# Story 8.2: Reschedule API

## Status
Approved

## Story

**As a** dispatcher,
**I want** to reschedule jobs via API,
**so that** I can move jobs to different time slots.

## Acceptance Criteria

1. **API Endpoint:** PUT /jobs/{id}/reschedule endpoint
2. **Request Validation:** New time slot validated
3. **Feasibility Check:** New slot checked for feasibility
4. **Assignment Update:** Assignment updated with new times
5. **Event Publishing:** JobRescheduled event published
6. **Authorization:** Dispatcher and Admin can reschedule
7. **Error Handling:** Proper errors for conflicts
8. **Response:** Updated job returned
9. **OpenAPI:** Endpoint documented
10. **Testing:** Comprehensive API tests

## Tasks / Subtasks

- [ ] Create reschedule DTOs
  - [ ] Create `RescheduleJobRequest` DTO
  - [ ] Include new startUtc and endUtc
- [ ] Implement reschedule command
  - [ ] Use RescheduleJobCommand
  - [ ] Validate request
  - [ ] Handle command
- [ ] Create API endpoint
  - [ ] PUT /jobs/{id}/reschedule endpoint
  - [ ] Validate request
  - [ ] Return updated job
- [ ] Add authorization
  - [ ] Apply Dispatcher/Admin policy
  - [ ] Verify permissions
- [ ] Add error handling
  - [ ] Handle conflicts (409)
  - [ ] Handle invalid time slot (400)
  - [ ] Handle not found (404)
- [ ] Integrate event publishing
  - [ ] Publish JobRescheduled event
  - [ ] Send via SignalR
- [ ] Add unit tests
  - [ ] Test endpoint
  - [ ] Test validation
  - [ ] Test error handling

## Dev Notes

### Relevant Source Tree Info
- API endpoint: `src/SmartScheduler.Api/Endpoints/Jobs/RescheduleEndpoint.cs`
- Command: Uses RescheduleJobCommand from Story 8.1

### Architecture References
- **API Specification:** Reschedule endpoint - see architecture (may need to be added)
- **Reschedule:** See `docs/prd/epic-8-reschedulecancel-calendar-integrity.md`
- **Events:** JobRescheduled event - see PRD

### Testing Standards
- **Test Location:** `src/SmartScheduler.Api.Tests/`
- **API Tests:** Test endpoint, validation, error handling

### UI Integration Notes
- Reschedule UI in job details
- Frontend calls this endpoint
- UI is 95% complete - needs API integration

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

