# Story 2.1: Job Domain Models

## Status
Ready for Review

## Story

**As a** developer,
**I want** job domain entities and value objects defined,
**so that** I can implement job CRUD operations with proper business logic.

## Acceptance Criteria

1. **Job Entity:** Job aggregate root with all required properties (id, type, description, duration, location, timezone, requiredSkills, serviceWindow, priority, status)
2. **Value Objects:** TimeWindow, GeoLocation (enhanced with structured address)
3. **Domain Validation:** Business rules enforced (required skills, valid service window, priority levels)
4. **Domain Events:** Domain events defined (JobCreated, JobAssigned, JobRescheduled, JobCancelled)
5. **Repository Interface:** IJobRepository interface defined in domain
6. **Status Management:** Job status transitions properly managed
7. **Assignment Status:** Computed assignment status (Unassigned, Partially Assigned, Assigned)
8. **Timezone Support:** Timezone stored and used for time calculations

## Tasks / Subtasks

- [x] Create domain entities
  - [x] Create `Job` aggregate root in `src/SmartScheduler.Domain/Contracts/Entities/`
  - [x] Add properties: Id, Type, Description, Duration, Location, Timezone, RequiredSkills, ServiceWindow, Priority, Status
  - [x] Add computed properties: AssignmentStatus, AssignedContractors
- [x] Create value objects
  - [x] Use enhanced `GeoLocation` with structured address fields (already exists)
  - [x] Create `TimeWindow` value object (start, end)
  - [x] Create `JobStatus` enum
  - [x] Create `Priority` enum (Normal, High, Rush)
  - [x] Create `AssignmentStatus` enum
- [x] Implement domain validation
  - [x] Required skills must not be empty
  - [x] Service window must be valid (start < end)
  - [x] Duration must be positive
  - [x] Location must have valid coordinates and address
- [x] Define domain events
  - [x] Create `JobCreated` event
  - [x] Create `JobAssigned` event
  - [x] Create `JobRescheduled` event
  - [x] Create `JobCancelled` event
- [x] Create repository interface
  - [x] Create `IJobRepository` in domain layer
  - [x] Define methods: GetById, GetAll, GetByStatus, GetByPriority, Add, Update, Delete

## Dev Notes

### Relevant Source Tree Info
- Domain entities: `src/SmartScheduler.Domain/Jobs/Entities/`
- Value objects: `src/SmartScheduler.Domain/Jobs/ValueObjects/`
- Domain events: `src/SmartScheduler.Domain/Jobs/Events/`
- Repository interfaces: `src/SmartScheduler.Domain/Jobs/Repositories/`

### Architecture References
- **Data Models:** See `docs/architecture/data-models.md` for Job model specification
- **Address Validation:** Google Places Autocomplete integration - see `docs/prd/epic-2-job-intake-attributes-windows.md`
- **Timezone:** Timezone lookup from coordinates - see architecture spec

### Testing Standards
- **Test Location:** `src/SmartScheduler.Domain.Tests/`
- **Domain Tests:** Unit tests for domain logic, validation, status transitions
- **Test Scenarios:** Valid job creation, invalid service window, status transitions, assignment status computation

### UI Integration Notes
- Frontend has `CreateJobDialog` component (see `frontend/components/jobs/create-job-dialog.tsx`)
- Frontend uses `AddressInput` component for address entry
- Frontend expects structured address data from Google Places API
- UI is 95% complete - needs API integration

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
N/A

### Completion Notes List
- Created Job aggregate root entity with all required properties and computed properties (AssignmentStatus, AssignedContractors)
- Created value objects: TimeWindow, JobStatus enum, Priority enum, AssignmentStatus enum
- GeoLocation already exists with enhanced structured address fields (no changes needed)
- Implemented comprehensive domain validation for all properties
- Created all required domain events: JobCreated, JobAssigned, JobRescheduled, JobCancelled
- Created IJobRepository interface with all required methods
- Implemented status transition validation
- Created comprehensive unit tests (63 tests total, all passing)
- All domain logic follows the same patterns as Contractor entity

### File List
**Created:**
- `src/SmartScheduler.Domain/Contracts/Entities/Job.cs` - Job aggregate root entity
- `src/SmartScheduler.Domain/Contracts/ValueObjects/JobStatus.cs` - JobStatus enum
- `src/SmartScheduler.Domain/Contracts/ValueObjects/Priority.cs` - Priority enum
- `src/SmartScheduler.Domain/Contracts/ValueObjects/TimeWindow.cs` - TimeWindow value object
- `src/SmartScheduler.Domain/Contracts/ValueObjects/AssignmentStatus.cs` - AssignmentStatus enum
- `src/SmartScheduler.Domain/Contracts/Events/JobCreated.cs` - JobCreated domain event
- `src/SmartScheduler.Domain/Contracts/Events/JobAssigned.cs` - JobAssigned domain event
- `src/SmartScheduler.Domain/Contracts/Events/JobRescheduled.cs` - JobRescheduled domain event
- `src/SmartScheduler.Domain/Contracts/Events/JobCancelled.cs` - JobCancelled domain event
- `src/SmartScheduler.Domain/Contracts/Repositories/IJobRepository.cs` - IJobRepository interface
- `src/SmartScheduler.Domain.Tests/Contracts/Entities/JobTests.cs` - Job entity unit tests
- `src/SmartScheduler.Domain.Tests/Contracts/ValueObjects/TimeWindowTests.cs` - TimeWindow value object tests

## QA Results
_To be populated by QA agent_

