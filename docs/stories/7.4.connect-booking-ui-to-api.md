# Story 7.4: Connect Booking UI to API

## Status
Approved

## Story

**As a** dispatcher,
**I want** the booking confirmation UI to use real API,
**so that** I can actually assign jobs to contractors.

## Acceptance Criteria

1. **API Integration:** Booking confirmation calls POST /jobs/{id}/assign
2. **Replace Mock:** All mock booking logic replaced with API calls
3. **Request Format:** Contractor ID and time slot sent correctly
4. **Success Handling:** Success message and UI update on assignment
5. **Error Handling:** Proper error messages for conflicts
6. **Loading States:** Loading indicator during assignment
7. **Optimistic Updates:** UI updates optimistically (with rollback on error)
8. **Real-time Updates:** UI updates via SignalR on JobAssigned event
9. **User Feedback:** Clear feedback for assignment success/failure
10. **Type Safety:** TypeScript types match API

## Tasks / Subtasks

- [ ] Update booking confirmation flow
  - [ ] Replace mock assignment with API call
  - [ ] Call POST /jobs/{id}/assign
  - [ ] Send contractor ID and time slot
- [ ] Add success handling
  - [ ] Show success message
  - [ ] Update job status in UI
  - [ ] Refresh job list
- [ ] Add error handling
  - [ ] Display API errors
  - [ ] Handle conflict errors (409)
  - [ ] Handle unavailable errors (400)
  - [ ] Show alternative suggestions
- [ ] Add loading states
  - [ ] Show loading indicator
  - [ ] Disable interactions during assignment
- [ ] Implement optimistic updates
  - [ ] Update UI immediately
  - [ ] Rollback on error
  - [ ] Sync with server state
- [ ] Integrate SignalR
  - [ ] Listen for JobAssigned event
  - [ ] Update UI on event
  - [ ] Handle event ordering
- [ ] Update recommendation display
  - [ ] Mark assigned contractor
  - [ ] Update availability indicators
- [ ] Add user feedback
  - [ ] Success toast notification
  - [ ] Error toast notification
  - [ ] Clear messaging

## Dev Notes

### Relevant Source Tree Info
- Booking components: `frontend/components/jobs/`
- API client: `frontend/lib/api/generated/api-client.ts`
- SignalR client: `frontend/lib/realtime/signalr-client.ts`

### Architecture References
- **API Specification:** See `docs/architecture/api-specification.md` for assignment endpoint
- **SignalR Events:** See `docs/prd/realtime.md` for JobAssigned event
- **UI Components:** Frontend booking components exist

### Testing Standards
- **Test Location:** `frontend/__tests__/`
- **Component Tests:** Test API integration, error handling, optimistic updates
- **E2E Tests:** Playwright tests for booking flow

### UI Integration Notes
- **Existing UI:** Booking UI is 95% complete with mock logic
- **Components:** Recommendation cards have "Assign" buttons
- **Flow:** User clicks assign → confirmation → API call
- **Mock Logic:** Currently simulates assignment - needs API replacement

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

