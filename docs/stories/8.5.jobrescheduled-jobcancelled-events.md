# Story 8.5: JobRescheduled/JobCancelled Events

## Status
Approved

## Story

**As a** system,
**I want** to publish JobRescheduled and JobCancelled events,
**so that** real-time updates are sent when jobs are rescheduled or cancelled.

## Acceptance Criteria

1. **JobRescheduled Event:** Event created and published
2. **JobCancelled Event:** Event created and published
3. **Event Payload:** Events include job and change details
4. **SignalR Publishing:** Events published via SignalR
5. **Event Logging:** Events logged to EventLog table
6. **Group Targeting:** Events sent to appropriate groups
7. **Error Handling:** Graceful handling of publishing failures
8. **Performance:** Event publishing doesn't block operations
9. **Testing:** Comprehensive tests
10. **Integration:** Integrated with reschedule/cancel flows

## Tasks / Subtasks

- [ ] Create JobRescheduled event
  - [ ] Create domain event
  - [ ] Include job and time change details
  - [ ] Define event schema
- [ ] Create JobCancelled event
  - [ ] Create domain event
  - [ ] Include job details
  - [ ] Define event schema
- [ ] Implement event publishing
  - [ ] Publish JobRescheduled after reschedule
  - [ ] Publish JobCancelled after cancel
  - [ ] Use in-process publisher
- [ ] Configure SignalR publishing
  - [ ] Send to dispatcher groups
  - [ ] Send to contractor group
  - [ ] Include event payload
- [ ] Log to EventLog
  - [ ] Persist events to EventLog
  - [ ] Include event details
- [ ] Add error handling
  - [ ] Handle publishing failures
  - [ ] Don't fail operation on publish error
- [ ] Optimize performance
  - [ ] Async event publishing
  - [ ] Don't block operations
- [ ] Create unit tests
  - [ ] Test event creation
  - [ ] Test event publishing
  - [ ] Test SignalR integration

## Dev Notes

### Relevant Source Tree Info
- Domain events: `src/SmartScheduler.Domain/Jobs/Events/`
- Event publisher: `src/SmartScheduler.Application/Events/EventPublisher.cs`

### Architecture References
- **Domain Events:** See `docs/prd/domain-events-integrations.md`
- **Events:** JobRescheduled, JobCancelled - see PRD
- **In-Process Publishing:** MVP uses in-process - see architecture

### Testing Standards
- **Test Location:** `src/SmartScheduler.Application.Tests/`
- **Event Tests:** Test event creation, publishing, SignalR integration

### UI Integration Notes
- Frontend listens for these events
- UI updates when events received
- Real-time updates improve UX

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

