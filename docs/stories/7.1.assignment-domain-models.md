# Story 7.1: Assignment Domain Models

## Status
Approved

## Story

**As a** developer,
**I want** assignment domain entities defined,
**so that** I can implement the booking flow with proper business logic.

## Acceptance Criteria

1. **Assignment Entity:** Assignment aggregate root with all required properties
2. **Relationships:** Assignment links Job to Contractor with time slots
3. **Status Management:** Assignment status transitions (Pending, Confirmed, InProgress, Completed, Cancelled)
4. **Source Tracking:** Track assignment source (auto or manual)
5. **Audit Link:** Link to AuditRecommendation
6. **Domain Events:** AssignmentCreated, AssignmentConfirmed events
7. **Repository Interface:** IAssignmentRepository interface
8. **Validation:** Business rules enforced
9. **Type Safety:** Strong typing for all concepts
10. **Testing:** Comprehensive domain tests

## Tasks / Subtasks

- [ ] Create Assignment entity
  - [ ] Create in `src/SmartScheduler.Domain/Assignments/`
  - [ ] Add properties: Id, JobId, ContractorId, StartUtc, EndUtc, Source, AuditId, Status
  - [ ] Add timestamps: CreatedAt, UpdatedAt
- [ ] Define status enum
  - [ ] Create AssignmentStatus enum
  - [ ] Define valid statuses
  - [ ] Document status transitions
- [ ] Implement relationships
  - [ ] Many-to-one with Job
  - [ ] Many-to-one with Contractor
  - [ ] One-to-one with AuditRecommendation
- [ ] Add domain validation
  - [ ] Validate start < end
  - [ ] Validate time slots
  - [ ] Validate relationships
- [ ] Define domain events
  - [ ] Create AssignmentCreated event
  - [ ] Create AssignmentConfirmed event
  - [ ] Create AssignmentCancelled event
- [ ] Create repository interface
  - [ ] Create IAssignmentRepository
  - [ ] Define methods: GetById, GetByJobId, GetByContractorId, Add, Update
- [ ] Add unit tests
  - [ ] Test entity creation
  - [ ] Test validation
  - [ ] Test status transitions

## Dev Notes

### Relevant Source Tree Info
- Assignment entity: `src/SmartScheduler.Domain/Assignments/Entities/Assignment.cs`
- Status enum: `src/SmartScheduler.Domain/Assignments/Enums/AssignmentStatus.cs`
- Repository interface: `src/SmartScheduler.Domain/Assignments/Repositories/IAssignmentRepository.cs`

### Architecture References
- **Data Models:** See `docs/architecture/data-models.md` for Assignment model
- **Relationships:** See data models for relationship structure
- **Domain Events:** See `docs/prd/domain-events-integrations.md`

### Testing Standards
- **Test Location:** `src/SmartScheduler.Domain.Tests/`
- **Domain Tests:** Test entity, validation, status transitions

### UI Integration Notes
- Assignments displayed in job details
- Assignment creation triggers booking flow
- UI components exist for assignment display

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story created | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

